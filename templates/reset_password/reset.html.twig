{# templates/reset_password/reset.html.twig #}
{% extends 'base.html.twig' %}

{% block title %}Définissez votre nouveau mot de passe{% endblock %}

{% block body %}
{# 1) Force le thème Bootstrap 5 pour CE formulaire, même si la config globale est absente ou écrasée #}
{% form_theme resetForm 'bootstrap_5_layout.html.twig' %}

<div class="min-vh-100 d-flex align-items-center bg-light py-5">
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-12 col-sm-10 col-md-8 col-lg-6 col-xl-5">



        <div class="card shadow-sm border-0">
          <div class="card-body p-4 p-md-5">

            <div class="text-center mb-4">
              <div class="rounded-circle d-inline-flex align-items-center justify-content-center bg-primary bg-opacity-10 p-3 mb-2">
                <svg width="28" height="28" viewBox="0 0 24 24" fill="currentColor" class="text-primary">
                  <path d="M12 1a5 5 0 00-5 5v3H6a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2v-8a2 2 0 00-2-2h-1V6a5 5 0 00-5-5zm-3 8V6a3 3 0 116 0v3H9z"/>
                </svg>
              </div>
              <h1 class="h4 mb-1">Définissez votre nouveau mot de passe</h1>
              <p class="text-muted mb-0">Choisissez un mot de passe robuste.</p>
            </div>

            {# 2) On garde la logique Symfony mais on “déplie” le RepeatedType pour styler les champs #}
            {{ form_start(resetForm, { attr: { novalidate: true } }) }}
              {% if resetForm.plainPassword.first is defined %}
                <div class="mb-3">
                  <label class="form-label" for="{{ resetForm.plainPassword.first.vars.id }}">Nouveau mot de passe</label>
                  <div class="input-group input-group-lg">
                    {{ form_widget(resetForm.plainPassword.first, {
                      attr: {
                        class: 'form-control form-control-lg',
                        autocomplete: 'new-password',
                        placeholder: 'Votre nouveau mot de passe',
                        'data-password-toggle-target': 'input'
                      }
                    }) }}
                    <button class="btn btn-outline-secondary" type="button" data-password-toggle>Afficher</button>
                  </div>
                  <div class="form-text">
                    12+ caractères, mélange de lettres/chiffres (et idéalement symboles).
                  </div>
                  {{ form_errors(resetForm.plainPassword.first) }}
                </div>

                <div class="mb-3">
                  <label class="form-label" for="{{ resetForm.plainPassword.second.vars.id }}">Confirmez le mot de passe</label>
                  {{ form_widget(resetForm.plainPassword.second, {
                    attr: {
                      class: 'form-control form-control-lg',
                      autocomplete: 'new-password',
                      placeholder: 'Confirmez votre mot de passe'
                    }
                  }) }}
                  {{ form_errors(resetForm.plainPassword.second) }}
                </div>
              {% else %}
                {# Cas rare : plainPassword n’est pas un RepeatedType #}
                {{ form_row(resetForm.plainPassword, {
                  row_attr: { class: 'mb-3' },
                  attr: {
                    class: 'form-control form-control-lg',
                    autocomplete: 'new-password',
                    placeholder: 'Votre nouveau mot de passe'
                  }
                }) }}
              {% endif %}

              <button class="btn btn-primary btn-lg w-100 mt-2" type="submit">
                Mettre à jour le mot de passe
              </button>
            {{ form_end(resetForm) }}

            <div class="text-center mt-3">
              <a href="{{ path('app_login') }}" class="text-decoration-none">Revenir à la connexion</a>
            </div>

          </div>
        </div>

        <p class="text-center text-muted small mt-3 mb-0">
          Astuce&nbsp;: utilisez une phrase de passe (facile à retenir, difficile à deviner).
        </p>

      </div>
    </div>
  </div>
</div>

{# 3) Toggle afficher/masquer #}
<script>
  document.addEventListener('click', function (e) {
    const btn = e.target.closest('[data-password-toggle]');
    if (!btn) return;
    const group = btn.closest('.input-group');
    const input = group?.querySelector('input');
    if (!input) return;
    const isPassword = input.type === 'password';
    input.type = isPassword ? 'text' : 'password';
    btn.textContent = isPassword ? 'Masquer' : 'Afficher';
  });
</script>
{% endblock %}
