{# templates/base.html.twig (SEO safe, drop-in) #}
<!DOCTYPE html>
<html lang="{% block html_lang %}fr{% endblock %}">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <meta name="theme-color" content="#0d6efd">
    {# Laisse le clic-to-call actif #}
    <meta name="format-detection" content="email=no,address=no">

    {# ===== Données par défaut ===== #}
    {% set default_title = 'Azur 66 Plomberie' %}
    {% set default_desc  = 'Plombier à Perpignan (66) : dépannages rapides, fuites, débouchage, chauffe-eau. Intervention dans tout le département des Pyrénées-Orientales.' %}
    {% set default_canonical = app.request.schemeAndHttpHost ~ app.request.pathInfo %}
    {% set default_url   = default_canonical %}
    {% set default_site  = app.request.schemeAndHttpHost %}
    {% set default_img   = asset('images/og-default.jpg') %} {# 1200x630 recommandé #}

    {# ===== Titre & metas SEO ===== #}
    <title>{% block title %}{{ default_title }}{% endblock %}</title>
    <meta name="description" content="{% block meta_description %}{{ default_desc }}{% endblock %}">
    <link rel="canonical" href="{% block canonical %}{{ default_canonical }}{% endblock %}">

    {% block meta_robots %}
      <meta name="robots" content="index,follow">
    {% endblock %}

    {# ===== Ciblage local (optionnel) ===== #}
    {% set po_cities = [
      'Perpignan','Canet-en-Roussillon','Saint-Cyprien','Argelès-sur-Mer','Collioure','Banyuls-sur-Mer',
      'Saint-Estève','Rivesaltes','Saint-Laurent-de-la-Salanque','Le Soler','Cabestany','Thuir',
      'Ille-sur-Têt','Céret','Prades','Elne','Bompas','Toulouges','Pollestres','Baho'
    ] %}
    <meta name="keywords" content="{% block meta_keywords %}plombier, dépannage, urgence, fuite, débouchage, chauffe-eau, {{ po_cities|join(', ') }}{% endblock %}">
    <meta name="geo.region" content="FR-66">
    <meta name="geo.placename" content="Pyrénées-Orientales">

    {# ===== Open Graph ===== #}
    <meta property="og:type" content="{% block og_type %}website{% endblock %}">
    <meta property="og:site_name" content="{{ default_title }}">
    <meta property="og:title" content="{% block og_title %}{{ block('title') }}{% endblock %}">
    <meta property="og:description" content="{% block og_description %}{{ block('meta_description') }}{% endblock %}">
    <meta property="og:url" content="{% block og_url %}{{ block('canonical') }}{% endblock %}">
    <meta property="og:image" content="{% block og_image %}{{ default_img }}{% endblock %}">
    <meta property="og:locale" content="{% block og_locale %}fr_FR{% endblock %}">

    {# ===== Twitter Card ===== #}
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="{% block tw_title %}{{ block('title') }}{% endblock %}">
    <meta name="twitter:description" content="{% block tw_description %}{{ block('meta_description') }}{% endblock %}">
    <meta name="twitter:image" content="{% block tw_image %}{{ block('og_image') }}{% endblock %}">

    {# ===== Hreflang (mono FR) ===== #}
    <link rel="alternate" href="{{ block('canonical') }}" hreflang="fr"/>

    {# ===== Favicon ===== #}
    <link rel="icon" type="image/svg+xml" href="{% block favicon_svg %}data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 128 128%22><text y=%221.2em%22 font-size=%2296%22>⚫️</text><text y=%221.3em%22 x=%220.2em%22 font-size=%2276%22 fill=%22%23fff%22>sf</text></svg>{% endblock %}">

    {# ===== Preloads  ===== #}
    {% block preloads %}
      {# Google Fonts #}
      <link rel="preconnect" href="https://fonts.googleapis.com">
      <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
      {# Optionnel : précharger l'image LCP de la home
      <link rel="preload" as="image" href="{{ asset('images/hero.webp') }}">
      #}
    {% endblock %}

    {# ===== CSS ===== #}
    {% block stylesheets %}
      {{ encore_entry_link_tags('app') }}
    {% endblock %}

    {# ===== JSON-LD LocalBusiness (Plumber) ===== #}
    {% set phone_e164 = '+33638776835' %}
    {% set business_email = (admin is defined and admin.email) ? admin.email : null %}
    {% set same_as = (admin is defined and admin.sameAs is defined) ? admin.sameAs : [] %}

    {% block jsonld %}
      <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "Plumber",
        "@id": "{{ default_site|e('js') }}/#business",
        "name": "Azur 66 Plomberie",
        "url": "{{ default_site|e('js') }}",
        "image": "{{ (block('og_image'))|e('js') }}",
        "description": "{{ (block('meta_description'))|e('js') }}",
        "telephone": "{{ phone_e164 }}",
        {{- business_email ? '"email": "' ~ business_email|e('js') ~ '",' : '' -}}
        "priceRange": "€€",
        "areaServed": {{ po_cities|json_encode|raw }},
        "address": {
          "@type": "PostalAddress",
          "addressLocality": "Perpignan",
          "addressRegion": "Occitanie",
          "postalCode": "66000",
          "addressCountry": "FR"
        },
        "contactPoint": [{
          "@type": "ContactPoint",
          "telephone": "{{ phone_e164 }}",
          "contactType": "customer service",
          "areaServed": "FR",
          "availableLanguage": ["fr"]
        }],
        "sameAs": {{ same_as|json_encode|raw }}
      }
      </script>
    {% endblock %}
  </head>

  <body>
    {# ===== Navbar ===== #}
    {% include 'navbar/navbar.html.twig' %}

    {# ===== Flash messages ===== #}
    {% for label, messages in app.flashes %}
      {% for message in messages %}
        <div class="alert alert-{{ label }}">{{ message }}</div>
      {% endfor %}
    {% endfor %}

    {# ===== Contenu ===== #}
    {% block body %}{% endblock %}

    {# ===== JS ===== #}
    {% block javascripts %}
      {{ encore_entry_script_tags('app') }}
    {% endblock %}
  </body>
</html>
