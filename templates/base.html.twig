{# templates/base.html.twig (SEO safe, drop-in) #}
<!DOCTYPE html>
<html lang="{% block html_lang %}fr{% endblock %}">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <meta name="theme-color" content="#0d6efd">
    {# Laisse le clic-to-call actif #}
    <meta name="format-detection" content="email=no,address=no">

    {# ===== Données par défaut ===== #}
    {% set default_title = 'Azur 66 Plomberie' %}
    {% set default_desc  = 'Plombier à Perpignan (66) : dépannages rapides, fuites, débouchage, chauffe-eau. Intervention dans tout le département des Pyrénées-Orientales.' %}
    {% set default_canonical = app.request.schemeAndHttpHost ~ app.request.pathInfo %}
    {% set default_url   = default_canonical %}
    {% set default_site  = app.request.schemeAndHttpHost %}
    {% set default_img   = asset('logo/logo_plombier.webp') %} {# 1200x630 recommandé #}

    {# ===== Titre & metas SEO ===== #}
    <title>{% block title %}{{ default_title }}{% endblock %}</title>
    <meta name="description" content="{% block meta_description %}{{ default_desc }}{% endblock %}">
    <link rel="canonical" href="{% block canonical %}{{ default_canonical }}{% endblock %}">

    {% block meta_robots %}
      <meta name="robots" content="index,follow">
    {% endblock %}

    {# ===== Ciblage local (optionnel) ===== #}
    {% set po_cities = [
      'Perpignan','Canet-en-Roussillon','Saint-Cyprien','Argelès-sur-Mer','Collioure','Banyuls-sur-Mer',
      'Saint-Estève','Rivesaltes','Saint-Laurent-de-la-Salanque','Le Soler','Cabestany','Thuir',
      'Ille-sur-Têt','Céret','Prades','Elne','Bompas','Toulouges','Pollestres','Baho'
    ] %}
    <meta name="keywords" content="{% block meta_keywords %}plombier, dépannage, urgence, fuite, débouchage, chauffe-eau, {{ po_cities|join(', ') }}{% endblock %}">
    <meta name="geo.region" content="FR-66">
    <meta name="geo.placename" content="Pyrénées-Orientales">

    {# ===== Open Graph ===== #}
    <meta property="og:type" content="{% block og_type %}website{% endblock %}">
    <meta property="og:site_name" content="{{ default_title }}">
    <meta property="og:title" content="{% block og_title %}{{ block('title') }}{% endblock %}">
    <meta property="og:description" content="{% block og_description %}{{ block('meta_description') }}{% endblock %}">
    <meta property="og:url" content="{% block og_url %}{{ block('canonical') }}{% endblock %}">
    <meta property="og:image" content="{% block og_image %}{{ default_img }}{% endblock %}">
    <meta property="og:image:width" content="{% block og_image_width %}1200{% endblock %}">
    <meta property="og:image:height" content="{% block og_image_height %}630{% endblock %}">
    <meta property="og:locale" content="{% block og_locale %}fr_FR{% endblock %}">

    {# ===== Twitter Card ===== #}
    {# <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="{% block tw_title %}{{ block('title') }}{% endblock %}">
    <meta name="twitter:description" content="{% block tw_description %}{{ block('meta_description') }}{% endblock %}">
    <meta name="twitter:image" content="{% block tw_image %}{{ block('og_image') }}{% endblock %}"> #}

    {# ===== Hreflang (mono FR) ===== #}
    <link rel="alternate" href="{{ block('canonical') }}" hreflang="fr"/>

    {# ===== Favicon ===== #}
    <link rel="icon" type="image/svg+xml" href="{% block favicon_svg %}data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 128 128%22><text y=%221.2em%22 font-size=%2296%22>⚫️</text><text y=%221.3em%22 x=%220.2em%22 font-size=%2276%22 fill=%22%23fff%22>sf</text></svg>{% endblock %}">

    {# ===== Preloads  ===== #}
    {% block preloads %}
      {# Google Fonts #}
      <link rel="preconnect" href="https://fonts.googleapis.com">
      <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      <link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap">
      <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet" media="print" onload="this.media='all'">
      <noscript>
        <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
      </noscript>
      {# Optionnel : précharger l'image LCP de la home
      <link rel="preload" as="image" href="{{ asset('images/hero.webp') }}">
      #}
    {% endblock %}

    {# ===== CSS ===== #}
    {% block stylesheets %}
      {{ encore_entry_link_tags('app') }}
    {% endblock %}

    {# ===== Analytics (GA4 placeholder) =====
       Procédure rapide pour obtenir l'ID GA4 :
       1) Aller sur Google Analytics
       2) Créer un compte (si besoin)
       3) Créer une propriété GA4
       4) Ajouter un flux de données Web (site)
       5) Copier l'ID de mesure (format G-XXXXXXXXXX)
       Remplacer G-XXXXXXXXXX par l'ID GA4 puis décommenter
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXXX"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-XXXXXXXXXX');
    </script>
    #}

    {# ===== Google Tag Manager (GTM placeholder) =====
       Procédure rapide pour obtenir l'ID GTM :
       1) Aller sur Google Tag Manager
       2) Créer un compte + conteneur (type Web)
       3) Copier l'ID de conteneur (format GTM-XXXXXXX)
       Remplacer GTM-XXXXXXX puis décommenter
    <script>
      (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
      new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
      })(window,document,'script','dataLayer','GTM-XXXXXXX');
    </script>
    #}

    {# ===== JSON-LD LocalBusiness (Plumber) ===== #}
    {% set phone_e164 = '+33638776835' %}
    {% set business_email = (app.user is defined and app.user and app.user.email is defined) ? app.user.email : null %}
    {% set same_as = (admin is defined and admin.sameAs is defined) ? admin.sameAs : [] %}

    {% block jsonld %}
      <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "Plumber",
        "@id": "{{ default_site|e('js') }}/#business",
        "name": "Azur 66 Plomberie",
        "url": "{{ default_site|e('js') }}",
        "image": "{{ (block('og_image'))|e('js') }}",
        "description": "{{ (block('meta_description'))|e('js') }}",
        "telephone": "{{ phone_e164 }}",
        {{- business_email ? '"email": "' ~ business_email|e('js') ~ '",' : '' -}}
        "priceRange": "€€",
        "areaServed": {{ po_cities|json_encode|raw }},
        "address": {
          "@type": "PostalAddress",
          "addressLocality": "Perpignan",
          "addressRegion": "Occitanie",
          "postalCode": "66000",
          "addressCountry": "FR"
        },
        "contactPoint": [{
          "@type": "ContactPoint",
          "telephone": "{{ phone_e164 }}",
          "contactType": "customer service",
          "areaServed": "FR",
          "availableLanguage": ["fr"]
        }],
        "openingHoursSpecification": [{
          "@type": "OpeningHoursSpecification",
          "dayOfWeek": ["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],
          "opens": "07:00",
          "closes": "20:00"
        }],
        "sameAs": {{ same_as|json_encode|raw }}
      }
      </script>
    {% endblock %}
  </head>

  <body>
    {# ===== Google Tag Manager (noscript placeholder) =====
       À placer juste après <body> si GTM est utilisé.
       Remplacer GTM-XXXXXXX puis décommenter
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-XXXXXXX"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    #}
    {# ===== Navbar ===== #}
    {% include 'navbar/navbar.html.twig' %}

    {# ===== Flash messages ===== #}
    {% for label, messages in app.flashes %}
      {% for message in messages %}
        <div class="alert alert-{{ label }}">{{ message }}</div>
      {% endfor %}
    {% endfor %}

    {# ===== Contenu ===== #}
    
  <main id="main-content">
    {% block body %}{% endblock %}
  </main>

    {# ===== Footer ===== #}
    {# {% include 'footer/footer.html.twig' %} #}

    {# ===== JS ===== #}
    {% block javascripts %}
      {{ encore_entry_script_tags('app') }}
    {% endblock %}
  </body>
</html>
